\documentclass[a4paper,12pt]{article}
\usepackage[koi8-r]{inputenc}
\usepackage[russian]{babel}
\usepackage{hyperref}
\usepackage{mathtext}
\usepackage[T2A]{fontenc}
\usepackage{array}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage[justification=centering,labelsep=period]{caption}
\usepackage{indentfirst}
\usepackage[pdftex]{graphicx,color}
\usepackage{textcomp}
\usepackage{gnuplot-lua-tikz}
\usepackage{tikz}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage[top=20mm,bottom=20mm,left=20mm,right=20mm]{geometry}



% \renewcommand{\captionlabeldelim} {.}

\makeatletter
\renewcommand\@biblabel[1]{#1.}
\makeatother

\unitlength=1mm

\usepackage{listings} %% собственно, это и есть пакет listings
% \usepackage{caption}
\DeclareCaptionFont{white}{\color{white}} %% это сделает текст заголовка белым
%% код ниже нарисует серую рамочку вокруг заголовка кода.
\DeclareCaptionFormat{listing}{\colorbox{white}{\parbox{\textwidth}{#1#2#3}}}
% \captionsetup[lstlisting]{format=listing,labelfont=black,textfont=black}
\renewcommand{\lstlistingname}{Листинг}


\begin{document}


\usetikzlibrary{arrows}

\lstset{ %
 language=Bash,                 % выбор языка для подсветки (здесь это С)
 basicstyle=\small\ttfamily, % размер и начертание шрифта для подсветки кода
 numbers=left,               % где поставить нумерацию строк (слева\справа)
 numberstyle=\tiny,           % размер шрифта для номеров строк
 stepnumber=1,                   % размер шага между двумя номерами строк
 numbersep=5pt,                % как далеко отстоят номера строк от
 % подсвечиваемого кода
 backgroundcolor=\color{white}, % цвет фона подсветки - используем
 showspaces=false,            % показывать или нет пробелы специальными
% отступами
 showstringspaces=false,      % показывать или нет пробелы в строках
 showtabs=false,             % показывать или нет табуляцию в строках
 frame=single,              % рисовать рамку вокруг кода
 tabsize=2,                 % размер табуляции по умолчанию равен 2 пробелам
 captionpos=t,              % позиция заголовка вверху [t] или внизу [b] 
 breaklines=true,           % автоматически переносить строки (да\нет)
% wordwrap=true,
 breakatwhitespace=false, % переносить строки только если есть пробел
 escapeinside={\%*}{*)}   % если нужно добавить комментарии в коде
 }


 
% \cygfamily

\author{Кузнецов В.В., ассистент кафедры ЭИУ1-КФ}
\title{Лабораторная работа \No 3 по курсу <<Радиотехнические устройства и
системы>> \\
Введение в Qucs}
\maketitle


\section{Цель работы}

Цель данного руководства --- рассмотрение процедуры проведения моделирования
аналоговых электрических схем в программе Qucs. 

Данная программа основана на вновь разработанном ядре схемотехнического
моделирования (разработка совместно с Берлинским институтом высокочастотной
техники) и работает под управлением операционных систем (ОС) Linux и Windows. В
данной программе возможно моделирование аналоговых и цифровых схем,
моделирование на постоянном и переменном токе и моделирование переходного
процесса. Недостатком программы является разделение аналогового и  цифрового
моделирования.

Родной операционной системой для Qucs является Linux, и при работе на этой
системы следует ожидать наибольшей производительности. Настоятельно
рекомендуется использовать для работы программы ОС Linux.

Версию Qucs для Linux можно установить в один клик, используя пакетный
менеджер, а версию для Windows можно скачать бесплатно с сайта разработчика
\url{http://qucs.souceforge.net}.

\section{Интерфейс программы}

\subsection{Главное окно}

После загрузки Qucs показывается главное окно, которое выглядит примерно как на
рис.\ref{qucs-mainwin}.  С правой стороны расположена рабочая область (3), в
которой содержатся схемы, документы показа данных и т.д. С помощью вкладок (2)
над этой областью можно быстро переключиться на любой документ, открытый в
данный момент. С левой стороны главного окна Qucs находится еще одна область
(8), содержание которой зависит от состояния вкладок, расположенных слева от
нее: "Проекты" , "Содержание"  и "Компоненты". С помощью выпадающего списка
(1), расположенного над областью (8) можно выбирать группы компонентов, которые
будут размещаться на схеме. Доступны следующие группы компонентов: дискретные
компоненты, источники, измерители, линии передачи, нелинейные компоненты,
устройства Verilog, цифровые компоненты, файловые компоненты, диаграммы,
рисунки. Компоненты размещаются на схеме методом перетаскивания из области (8)
на рабочую область (3). Типы моделирования размещаются на схеме так же как и
компоненты. 

Над рабочей областью располагается главное меню и панель инструментов.
Назначение пунктов меню и кнопок на панели инструментов понятно из их названия.
Стоит отметь кнопку вставки уравнений (5), с помощью которой можно размещать на
схеме уравнения. С помощью кнопки вставки имени узла (6) можно задавать имена
узлам на схеме, а с помощью кнопки (7) --- соединять компоненты проводами. 
Запустить моделирования можно и с клавиатуры, нажав клавишу F2 или с помощью
кнопки (4).

Кнопка (10) служит для возврата в режим выделения компонентов. После нажатия на
эту кнопку по левому щелчку мыши происходит выделение компонентов на схеме.

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{Lab4ris/Qucs-mainwindow.png}
\end{center}
\caption{Главное окно программы Qucs. 1 --- выпадающий список с типами
компонентов, видов моделирования и диаграмм; 2 --- вкладки с открытыми схемами;
3--- рабочая область; 4 --- кнопка запуска моделирования; 5 --- кнопка вставки
уравнения; 6 --- кнопка вставка имени узла; 7 --- кнопка вставки проводов; 8 ---
область выбора компонентов; 9 --- кнопка вставки маркера на
график; 10 --- кнопка перехода в режим выделения
компонентов }\label{qucs-mainwin}
\end{figure}



По правому щелчку мыши на любом компоненте можно открыть контекстное меню
компонента. По двойному щелчку мыши открывается диалоговое окно свойств
компонента, в котором можно задавать, например сопротивление резисторов,
ёмкость конденсаторов, параметры транзисторов и т.п. Ещё параметры компонентов
можно изменить по левому щелчку мыши на значении сопротивления, ёмкости и т.п.
в рабочей области. При этом параметр подсвечивается и с клавиатуры можно
напечатать новое значение параметра и затем нажать клавишу Enter. Для видов
моделирования задаются параметры моделирования, например отрезок времени для
моделирования переходного процесса или диапазон частот при моделировании на
переменном токе. 

Компоненты соединяются с помощью проводов. Провода добавляются на схему
нажатием на кнопку (7) на рис.\ref{qucs-mainwin}. Схема не будет работать без
заземления (GND). Заземление --- это особый компонент, который добавляется на
схему при помощи кнопки с пиктограммой заземления на панели инструментов.

\subsection{Библиотека компонентов}

Выбрав пункт меню Инструменты-> Библиотека компонентов, можно открыть
библиотеку компонетов (см. рис.\ref{complib}).

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=0.6\textwidth]{Lab4ris/Complib.png}
\end{center}
\caption{Библиотека компонентов}\label{complib}
\end{figure}

Библиотека содержит готовые модели для различных электронных компонентов
(диоды, транзисторы, операционные усилители), которые из окна библиотеки можно
перетаскивать на схему.

\subsection{Сохранение и открытие документов}

После запуска Qucs у Вас еще нет ни одного документа, поэтому нажмите кнопку
сохранения на панели инструментов (или используйте главное меню:
Файл->Сохранить) чтобы сохранить документ без названия, который заполняет
рабочую область (3). После этого появится диалоговое окно для ввода имени нового
документа. Введите "firstSchematic" и нажмите кнопку "Сохранить". Файлы схем
Qucs имеют расширение sch и сохраняются в формате XML.

Чтобы открыть схему Qucs в главном меню нужно выбрать Файл->Открыть, или нажать
кнопку на панели инструментов. В диалоговом окне выбрать файл с расширением
sch, например "firstSchematic.sch".



\section{Моделирование на постоянном токе}

Целью моделирования на постоянном токе (DC-analisys) является расчёт рабочей
точки электронных схем. Предполагается, что через все узлы схемы протекает
постоянный ток.

Рассчитаем режим работы транзистора в однокаскадном усилителе. Сначала размещаем
на поле схемы все компоненты (см. рис. \ref{DC}) и соединяем их проводами.
Чтобы поместить на схему транзистор выбираем в главном меню
Инструменты->Библиотека компонентов, в выпадающем списке в открывшемся окне
(см. рис.\ref{complib}) выбираем библиотеку Transistors. И в списке выбираем
транзистор 2N2222A и перетаскиваем его на схему. 

Элементы R и С находятся в группе <<Дискретные компоненты>> в списке (1) на
рис.\ref{qucs-mainwin}, а источник постоянного тока (батарея) в группе
<<Источники>>. 

После того, как схема сформирована нужно задать типы моделирования. Для этого в
выпадающем списке (1) в левой части окна программы (см. рис.\ref{qucs-mainwin})
выбираем пункт <<Виды моделирования>>. Из области компонентов (8) перетаскиваем
на схему компонент <<Моделирование на постоянном токе>>. Параметры для
моделирования на постоянном токе задавать не нужно.

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{Lab4ris/DC-BJT.png}
\end{center}
\caption{Схема для моделирования на постоянном токе}\label{DC}
\end{figure}

Теперь сохраняем схему, например в файл BJT.sch, выбрав в главном меню
Файл->Сохранить. Моделирование на постоянном токе запускается нажатием на
клавишу F8 на клавиатуре. Qucs рассчитывает рабочую точку транзисторного
каскада и показывает напряжения на узлах схемы (узел --- точка соединения двух
или более компонентов) рядом с этими узлами. Чтобы посмотреть токи в ветвях
схемы, нужно последовательно с компонентов включить специальный компонент ---
измеритель тока. После проведения моделирования на постоянном токе, рядом с
измерителем тока отображается рассчитанное значение тока. Значение напряжения
подсвечивается синим цветом, а тока --- зелёным. Результат расчёта рабочей
точки нашего транзисторного каскада показан на рис.\ref{DCres}.

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{Lab4ris/DC-BJT-mod.png}
\end{center}
\caption{Расчёт рабочей точки транзисторного каскада}\label{DCres}
\end{figure}

\textbf{Задание:} Подобрать резистор R1 в цепи базы транзистора, чтобы
напряжение на коллекторе было равно 6 В.

\section{Моделирование переходного процесса}

Моделирование переходного процесса (Transient Analisys) позволяет получить
отклик на выходе схемы на какое-либо входное воздействие. Например если на вход
усилителя мы подаём синусоидальный сигнал, то в результате анализа переходных
процессов мы получим сигнал на выходе усилителя. 



Смоделируем отклик транзисторного однокаскадного усилителя низкой частоты, если
на его вход подано синусоидальное напряжение амплитудой 200 мВ и частотой 10
кГц.

Для этого сначала собираем схему усилителя (см. рис. \ref{TR}). Особенностью
этой схемы является, то что двум узлам, соответствующим входу и выходу
усилителя, заданы имена in и out соответственно при помощи кнопки (6) на
рис.\ref{qucs-mainwin}. Кроме моделирования переходного процесса для схем,
содержащих активные компоненты, нужно обязательно проводить расчёт рабочей
точки. Для этого поместим на схеме компонент моделирования на постоянном токе. 

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{Lab4ris/TR-BJT.png}
\end{center}
\caption{Однокаскадный транзисторный усилитель}\label{TR}
\end{figure}

После того как все компоненты размещены на рабочем поле схемы и соединены между
собой проводами и перед тем как запустить моделирование, нужно задать параметры
моделирования переходного процесса: длительность моделирования и число точек
для расчёта. Для этого дважды щёлкнем на виртуальном компоненте TR1, и
в открывшемся окне вводим параметры для моделирования переходного процесса (см.
рис.\ref{TRsetup}). Начало моделирования 0мс, конец моделирования 1мс (1 ms) и
шаг моделирования 1 мкс = $10^{-6}\,с$. Установка таких параметров обеспечивает
моделирование схемы на отрезке времени от включения (0 мс) до 1 мс.
Рассчитываются напряжения и токи в компонентах схемы через каждую 1 мкс. 
Все буквы в обозначениях единиц измерений на рис.\ref{TRsetup} строго
латинские. Русские буквы не допускаются.

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=0.5\textwidth]{Lab4ris/Trans-setup.png}
\end{center}
\caption{Установка параметров моделирования переходного процесса}\label{TRsetup}
\end{figure}

Чтобы запомнить параметры моделирования необходимо в диалоговом окне нажать
ОК. После того как мы установили все параметры моделирования, запускаем
моделирование нажатием на F2 на клавиатуре или нажав кнопку моделирования на
панели инструментов. Происходит расчёт и после его окончания создаётся пустая
вкладка страницы просмотра (см. рис. \ref{dpl-win}). Чтобы посмотреть полученные
временные диаграммы напряжений на входе и на выходе усилителя, нужно на этой
странице сначала разместить график, а потом установить параметры этого графика.

Чтобы поместить на странице просмотра график, нужно перетащить на страницу
просмотра специальный компонент (см. рис.\ref{dpl-win}). После размещения
график будет пустой.

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=0.95\textwidth]{Lab4ris/DPL-win.png}
\end{center}
\caption{Размещение на странице просмотра диаграммы}\label{dpl-win}
\end{figure}

Моделированию переходного процесса соответствует применение осциллографа при
налаживании и проверке реальных электронных устройств. Некоторые программы,
аналогичные Qucs, даже используют виртуальный осциллограф для этих целей. И

На практике, однако, важнее не вид осциллографа, а вид осциллограмм. Получающие
все большее распространение осциллографические приставки к компьютеру
ориентированы именно на запоминание и показ осциллограмм. Эти же функции
становятся обязательным атрибутом и остальных осциллографов. Результаты
моделирования переходного процесса в Qucs можно наблюдать в виде привычной
диаграммы, если выбрать в группе диаграммы Декартовский вид отображения данных.
Сигналы могут быть импульсными или синусоидальными, или любой произвольной
формы. Но они соответствуют тому, что вы увидели бы на экране осциллографа, если
проверяли бы работу схемы на макетной плате.

После того, как на странице просмотра размещёна график, нужно разместить на
графике нужные кривые. После моделирования создаётся служебный файл, называемый
<<набор данных>>. В наборе данных содержатся результаты расчётов. Чтобы
добавить на график кривую, нужно в свойствах графика выбрать нужный нам
результат из набора данных. Если дважды щёлкнуть мышью по графику, помещённому
на странице просмотра, то откроется окно установки свойств графика (рис.
\ref{DPLsetup}).

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=0.5\textwidth]{Lab4ris/Diagr-setup.png}
\end{center}
\caption{Установка параметров диаграммы и отображаемых кривых
на диаграмме}\label{DPLsetup}
\end{figure}

В ревой части открывшегося окна находятся результаты расчётов. Осциллограммы
переходного процесса имеют следующее обозначение: \verb|имя_уза.Vt| (см.
рис.\ref{DPLsetup}). Результаты переходного процесса всегда обозначаются
\verb|.Vt|. Чтобы на графике разместить осциллограммы переходного процесса на
входе и на выходе усилителя, нужно дважды щёлкнуть по имени результата в левой
части окна, и он перемещается в правую часть окна.  Чтобы посмотреть на графике
осциллограммы напряжения на входе и на выходе усилителя, нужно разместить на
нём кривые \verb|in.Vt| и \verb|out.Vt|, отмеченные  на рис. \ref{DPLsetup}.

В результате на странице просмотра отобразятся осциллограммы напряжений на
входе и на выходе усилителя (рис. \ref{TRres}). На рисунке видно, что на
графиках размещены маркеры. Маркеры вставляются на кривые на осциллограмме с
помощью кнопки (9) в главном окне программы (см. рис.\ref{qucs-mainwin}).
Маркеры являются аналогом курсорных измерений в осциллографе. С помощью
маркеров можно узнать, например, напряжение в определённый момент времени. На
рисунке с помощью маркеров мы можем узнать уровень напряжения на пиках
синусоиды.

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{Lab4ris/TR-res.png}
\end{center}
\caption{Результаты моделирования переходного процесса. Маркеры на
осциллограммах.}\label{TRres}
\end{figure}

Итак, мы промоделировали работу однокаскадного усилителя на биполярном
транзисторе. Из осциллограмм напряжения на входе и на выходе усилителя видно,
что выходной сигнал находится в противофазе к входному и значительно больше его
по амплитуде. Поделив напряжения на выходе и на входе усилителя, получим
коэффициент усиления $K_у=1.7\,В/0.2\,В=8.5$.

\section{Моделирование на переменном токе}

Моделирование на переменном токе (AC analisys) позволяет получить
амплитудно-частотные (АЧХ) и фазочастотные характеристики (ФЧХ) электронного
устройства. 

АЧХ --- это зависимость модуля коэффициента передачи от частоты. 

Исследуем АЧХ и ФЧХ однокаскадного усилителя на биполярном транзисторе из
предыдущего раздела. Сначала собираем схему (см. рис.\ref{AC}). 

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{Lab4ris/AC-BJT.png}
\end{center}
\caption{Схема для моделирования на переменном токе.}\label{AC}
\end{figure}

Схема повторяет схему из предыдущего раздела (рис.\ref{TR}), но здесь
добавляются два новых компонента: <<Моделирование на переменном токе>> (АС1) и
<<Уравнение>>. Компонент <<Моделирование на переменном токе>> находится в
группе компонентов <<Виды моделирования>> и служит для задания параметров
(начальная и конечная частота и число точек расчёта) расчёта схемы на переменном
токе. Чем больше мы возьмём точек расчёта, тем медленнее будет моделирование,
но тем точнее будет форма АЧХ. 

В ходе моделирования на переменном токе последовательно изменяется частота
источника переменного тока (V2 на схеме рис.\ref{TR}) от начальной до конечной
частоты и для каждой частоты производится расчёт напряжений и токов в схеме.

Мы будем моделировать АЧХ в диапазоне частот от 100 Гц до 10 МГц ($10^7$ Гц).
Рассчитаем АЧХ по 1000 точкам. Чтобы установить эти параметры нужно дважды
щёлкнуть мышью по компоненту моделирование на переменном токе. Открывается
диалоговое окно (рис.\ref{ACsetup}), и в нём нужно ввести параметры в
соответствующие поля ввода. 

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=0.5\textwidth]{Lab4ris/ACsetup.png}
\end{center}
\caption{Установка параметров моделирования на переменном токе.}\label{ACsetup}
\end{figure}

Компонент <<Уравнение>> нужен для того, чтобы вычислить коэффициент усиления
усилителя, зная напряжения на его выходе и входе и затем построить график
зависимости коэффициента усиления от частоты.

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=0.5\textwidth]{Lab4ris/EQ-setup.png}
\end{center}
\caption{Задание уравнений.}\label{EQsetup}
\end{figure}

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=0.5\textwidth]{Lab4ris/AC-diag-setup.png}
\end{center}
\caption{Установка параметров диаграммы для просмотра
результатов моделирования на переменном токе.}\label{ACdiagsetup}
\end{figure}

\begin{figure}[!ht]
\begin{center}
\includegraphics[width=0.5\textwidth]{Lab4ris/AC-diag-log.png}
\end{center}
\caption{Установка логарифмической шкалы по оси Х (частота).}\label{AClogsetup}
\end{figure}


\begin{figure}[!ht]
\begin{center}
\includegraphics[width=\textwidth]{Lab4ris/AC-res.png}
\end{center}
\caption{Результаты моделирования АЧХ и ФЧХ транзисторного
усилителя.}\label{ACres}
\end{figure}

\section{Заключение}

В результате выполнения лабораторной работы произведено ознакомление с
принципами статистического анализа данных, программирования и файлового
ввода-вывода в системе GNU/Octave.

\end{document}
